# Инструкция
### Окружение
- php 7.4
- mysql 8
- apache 2.4.54
- CsCart 4.16.1 (Язык en)
- Интерфейс для взаимодействия с бд: phpMyAdmin, MySqlWorkBench

### Как развернуть приложение
Установить CsCart, следуя всем рекомендациям. Далее проинициализировать локальный репозиторий. Следующим шагом нужно добавить удаленный репозиторий (git remote add simtech_school https://github.com/sodaler/simtech_school.git). Далее добавляем .gitignore, https://github.com/sodaler/simtech_school с данного репозитория (в нем также прописываем .gitignore) и вводим комманду  git clean  -d  -f . , также прописываем git fetch simtech_school development, чтобы вытянуть данные, последним шагом нужно отследить данную ветку коммандой git checkout development. После этого, в .gitignore убираем запись .gitignore.
Далее нужно настроить конфигурационный файл в cscart config.local.php (если хотим поменять автоматические настройки), мои данные:
БД:

    $config['db_host'] = 'localhost';
    $config['db_name'] = 'simtech_dev';
    $config['db_user'] = 'root';
    $config['db_password'] = '';
    $config['database_backend'] = 'mysqli';
    $config['table_prefix'] = 'cscart_';

Хост:

    $config['http_host'] = 'localhost';
    $config['http_path'] = '/simtech-dev_profi';

Следующим шагом, нужно импортировать дамп базы данных: дампы располагаются в var/backups. Там располагается полный дамп со структурой и данными всех таблиц, далее структура отделов и дамп с данными для отделов, пользователей и языковыми переменными. Стоит обратить внимание, что в полном дампе первый пользователь присутствует, как администратор, в дампе только с данными пользователи идут с 2 идентификатора (тк 1 формируется при установки CsCart).
Администратор:

    email: sodaler779@mail.ru
    password: sodaler779

Также можно попробовать просто склонировать проект (скачать, либо через команду git clone и произвести дамп базы данных, но  меня ядро CsCart захотело забанить и я прибег к 1 решению.

Стоит отметить, что в .gitignore отмечены изображения, поэтому их нужно добавить вручную. Папка с ними располагается также в var/backups.

## Настройка локального окружения
1 вариант:

2.1) Для начала нужно установить apache 2.4 и провести настройку конфига - файл httpd.conf

Что менять:
 - Define SRVROOT "E:/apache2.4/Apache24" - на свой путь
 - ServerName localhost
 - DocumentRoot "E:/simtechProjects/htdocs"
 - <Directory "E:/simtechProjects/htdocs> - на свой путь
 - DirectoryIndex index.html index.htm index.php
 - Раскомментировать LoadModule rewrite_module modules/mod_rewrite.so
 - В конце файла добавить:
<IfModule ssl_module>
SSLRandomSeed startup builtin
SSLRandomSeed connect builtin
</IfModule>
PHPIniDir "E:/xampp/php" (путь, где установлен php)
AddHandler application/x-httpd-php .php
LoadModule php_module "E:/xampp/php/php8apache2_4.dll" (путь, где установлен php)

Далее в консоли прописать e:\Apache2.4\Apache24\bin\httpd.exe -k install (указать свой путь).
Далее e:\Apache2.4\Apache24\bin\httpd.exe -k start (указать свой путь)

Мы настроили файл и запустили службу Apache24

2.2) Затем нужно установить php и включить поддержку расширений.
Это делается в файле php.ini, если его нету - ищем php.ini-development и
переименовываем его в php.ini, далее производим настройку.
Раскомментируем ;extension_dir и в нем прописываем нужный путь.
Ищем extension и раскомментируем нужные расширения.

2.3) Устанавливаем mysql, создаем файл my.ini и добавляем:

[mysqld]
sql_mode=NO_ENGINE_SUBSTITUTION,STRICT_TRANS_TABLES
datadir="e:/mysql/data/DB/data/"
default_authentication_plugin=mysql_native_password

Также создадим директории data/DB/data

И пропишем в консоли

    E:\mysql\bin\mysqld --initialize-insecure --user=root
    E:\mysql\bin\mysqld --install
    E:\mysql\bin\net start mysql
Мы настроили mysql и запустили службу.

2.4) Можно создать виртуальные хосты и установить интерфейс для
администрирования БД. (опционально)

2.4.1) В файле httpd.conf раскомментируем строку под # Virtual hosts и поменяем DocumentRoot (если проекты лежат в другой папке).

В файле httpd-vhosts.conf удалим приведенный пример и впишем наши виртуальные хосты.

Добавим хосты в файл hosts, который находится в c:/Windows/System32/drivers/etc
Пример: 127.0.0.1 myproj

Перезапускаем службу apache24 и можем подключиться к нашим хостам
Пример: http://myproj

2.4.2*) Устанавливаем mysqlworkbench и выполняем подключение
127.0.0.1:3306   user = root   password = ""

2 вариант:
Скачиваем xampp, он автоматически скачает apache, mysql, phpmyadmin
Можем настроить нужные порты (либо оставить по умолчанию - 80 для apache и 3306 для mysql)
Запускаем apache и mysql - готово!

## Руководство пользователя
### Админ панель:
В меню Customers, можно перейти в подменю Departments. На данной странице выводятся все отделы и можно произвести по ним поиск, отсортировать по полям, также удалить выбранные или только один отдел, если нажать на отдел. Нажав на кнопку сверху, можно будет добавить новый отдел. Нажав на сам отдел, можно будет перейти к редактированию отдела. В создании или редактировании отдела имеются следующие поля: имя, описание, изображение, дата создания (только в редактировании), статус и 2 пикера, с помощью которых можно выбрать руководителя и сотрудников отдела.
### Витрина
Чтобы увидеть страницу с отделами на витрине, нужно нажать на выпадающий список в области аккаунта и выбрать пункт Departments. На данной странице выводятся все отделы, отделы включают в себя изображение, название, имя и фамилию руководителя. Нажав на отдел, Вы перейдете на карточку отдела, где будет более подробная информация об отделе: изображение, название, описание, руководитель и сотрудники.

Стоит отметить, что каждая страница обладает дополнительным функционалом для удобства, таким, как пагинация, форма для описания с большим функционалом, сортировки и поиск и тд.

## Тесты
Тесты располагаются в папке var/tools/tests. DepartmentCest.php - автотест.

### Инструкция по запуску теста
Для начала нужно установить CodeCeption через composer.

    composer require "codeception/codeception" --dev

Далее создать конфигурационные файлы, с помощью команды:

    php vendor/bin/codecept bootstrap

После установки, нужно изменить url хоста на свой в файле Acceptance.suite.yml

Далее переместить файл DepartmentCest.php в директорию tests/Acceptance

Последним шагом следует запустить сам тест, с помощью команды

    php vendor/bin/codecept run --steps

Тест проверяет авторизацию, отображение полей и данных (в админ панеле и на витрине), также создание отдела и его удаление.
